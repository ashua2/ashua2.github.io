<!DOCTYPE html>
<html>
    <head>
        <title>Data Visualization of COVID-19 in Chicago</title>
    </head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <body>
        <h1 style="text-align:center;font-family:tahoma;color:darkslategray">Data Visualization of COVID-19 in Chicago</h1>
        <p style="font-family:tahoma">testing</p>

        <div id="linechart"></div>



        <script>
            // svg
            var margin = {top: 10, right: 40, bottom: 100, left: 100};

            width = 960 - margin.left - margin.right;
            height = 500 - margin.top - margin.bottom; 

            var svg = d3.select("#linechart")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform","translate(" + margin.left + "," + margin.top + ")");

            // dataset cleaning + storing

            var parseTime = d3.timeParse('%m-%d%-%Y');

            d3.csv("https://gist.githubusercontent.com/ashua2/c369a7bbca9311c50632a9a9c138f30d/raw/a381a14cc3838487451cc90cb5b9476c6e4cca3d/covid_deaths_cases_by_race.csv").then(function(dataset) {
                console.log(dataset);
                var dates_deaths_race = [];

                dataset.forEach(function(data) {
                    data.cases_female = +data.cases_female;
                    data.deathsTotal = +data.deathsTotal,
                    data.casesTotal = +data.casesTotal
                    data.hospitalizationsTotal = +data.hospitalizationsTotal;
                    data.cases_0_17 = +data.cases_0_17;
                    data.cases_18_29 = +data.cases_18_29;
                    data.cases_30_39 = +data.cases_30_39;
                    data.cases_40_49 = +data.cases_40_49;
                    data.cases_50_59 = +data.cases_50_59;
                    data.cases_60_69 = +data.cases_60_69;
                    data.cases_70_79 = +data.cases_70_79;
                    data.cases_80 = +data.cases_80;

                    let race_deaths = {
                        "date": new Date(+(data.date.slice(6)), +(data.date.slice(0,2) - 1), +(data.date.slice(3,5))),
                        "latinx_deaths": +data.deaths_latinx,
                        "asian_deaths": +data.deaths_asian_nonlat,
                        "black_deaths": +data.deaths_black_nonlat,
                        "white_deaths": +data.deaths_white_nonlat,
                        "other_deaths": +data.deaths_other_nonlat
                    }
                    if (race_deaths.date <= new Date(2021, 2, 1) && race_deaths.date >= new Date(2020, 2, 1)) {
                        dates_deaths_race.push(race_deaths);
                    }
                    
                });

                dates_deaths_race.sort(function(o1,o2){
                    return o1.date - o2.date;
                });

                console.log(dates_deaths_race);

            // creating axes + labels

                var dates_x_axis = d3.scaleTime()
                    .domain([new Date(2020, 2, 1), new Date(2021, 2, 1)])
                    .range([0, width]);

                var deaths_y_axis = d3.scaleLinear()
                    .domain([0, 30])
                    .range([height, 0]);
                
                d3.select("svg").append("g")
                    .attr("transform","translate(75,30)")
                    .call(d3.axisLeft(deaths_y_axis));

                d3.select("svg").append("g")
                    .attr("transform","translate(75," + (height + margin.top + 20) + ")")
                    .call(d3.axisBottom(dates_x_axis));
                
                svg.append('text')
                    .attr('x', width/2).attr('y', height + 65).attr('text-anchor', 'middle')
                    .style('font-family', 'tahoma').style('font-size', 15)
                    .text('Month');

                svg.append('text')
                    .attr('text-anchor', 'middle').attr('transform', 'translate(-60,' + height/2 + ')rotate(-90)')
                    .style('font-family', 'tahoma').style('font-size', 15)
                    .text('Deaths');

            // colored lines

                svg.append("path")
                    .datum(dates_deaths_race)
                    .attr("fill", "none")
                    .attr("stroke", "cornflowerblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return dates_x_axis(d.date) - margin.right/2 })
                        .y(function(d) { return deaths_y_axis(d.latinx_deaths) + margin.top*2 }));

                svg.append("path")
                    .datum(dates_deaths_race)
                    .attr("fill", "none")
                    .attr("stroke", "violet")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return dates_x_axis(d.date) - margin.right/2 })
                        .y(function(d) { return deaths_y_axis(d.asian_deaths) + margin.top*2 }));

                svg.append("path")
                    .datum(dates_deaths_race)
                    .attr("fill", "none")
                    .attr("stroke", "orange")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return dates_x_axis(d.date) - margin.right/2 })
                        .y(function(d) { return deaths_y_axis(d.black_deaths) + margin.top*2 }));

                svg.append("path")
                    .datum(dates_deaths_race)
                    .attr("fill", "none")
                    .attr("stroke", "crimson")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return dates_x_axis(d.date) - margin.right/2 })
                        .y(function(d) { return deaths_y_axis(d.white_deaths) + margin.top*2 }));

                svg.append("path")
                    .datum(dates_deaths_race)
                    .attr("fill", "none")
                    .attr("stroke", "mediumaquamarine")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return dates_x_axis(d.date) - margin.right/2 })
                        .y(function(d) { return deaths_y_axis(d.other_deaths) + margin.top*2 }));

               /* var legend_codes = [{"color": "orange", "race": "Black"}, 
                    {"color": "crimson", "race": "Asian"},
                    {"color": "cornflowerblue", "race": "Latinx"},
                    {"color": "mediumaquamarine", "race": "Other"},
                    {"color": "violet", "race": "White"}]; */
                var races = ["Black", "Asian", "Latinx", "Other", "White"];
                var colors = ["orange", "violet", "cornflowerblue", "mediumaquamarine", "crimson"];

                svg.append("circle")
                    .datum(colors)
                    .attr("cx", 750)
                    .attr("cy", 130)
                    .attr("r", 5)
                    .style("fill", function(d,i) {return colors[i];});
                
                /* svg.append("text")
                    .data(races).enter()
                    .attr("x", "730")
                    .attr("y", function(d,i) {return 130 + i*30;})
                    .attr("alignment-baseline","middle")
                    .text(function(d) {return d;})
                    .style("font-size", "15px").style("font-family", "tahoma"); */
            });
        </script>
    </body>
</html>